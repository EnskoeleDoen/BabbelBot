<!DOCTYPE html>
<html lang="nl">
<head>
  <!-- ... (onveranderde stijlen en meta tags) ... -->
</head>
<body>
  <!-- ... (onveranderde HTML structuur) ... -->

  <script>
    // Firebase configuratie en initialisatie (onveranderd)
    const firebaseConfig = { /* ... */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Elementen selecteren (onveranderd)
    const chatContainer = document.getElementById("chat-container");
    const messageInput = document.getElementById("message-input");
    const sendButton = document.getElementById("send-button");

    // Firebase listener (onveranderd)
    db.collection("messages").orderBy("timestamp").onSnapshot(/* ... */);

    // Aangepaste vertaalfunctie
    async function translateText(text, sourceLang, targetLang) {
      try {
        const response = await fetch("https://libretranslate.com/translate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            q: text,
            source: sourceLang,
            target: targetLang,
            format: "text"
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(`API-fout: ${JSON.stringify(errorData)}`);
        }

        const data = await response.json();
        return data.translatedText;
      } catch (error) {
        console.error("Vertalingsfout:", error);
        return text;
      }
    }

    // Verbeterde verzendfunctie met taaldetectie
    async function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;

      try {
        // Taal detecteren
        const detectResponse = await fetch("https://libretranslate.com/detect", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ q: text })
        });

        if (!detectResponse.ok) throw new Error("Taaldetectie mislukt");
        
        const [detection] = await detectResponse.json();
        const sourceLang = detection.language;
        const targetLang = sourceLang === 'en' ? 'nl' : 'en';

        // Vertalen en opslaan
        const translated = await translateText(text, sourceLang, targetLang);
        await db.collection("messages").add({
          original: text,
          translated: translated,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        messageInput.value = "";
      } catch (error) {
        console.error("Verzendfout:", error);
      }
    }

    // Event listeners (onveranderd)
    sendButton.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>